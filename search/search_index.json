{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Index","text":""},{"location":"#un-plugin-qgis-pour-les-rassembler-tous","title":"\"Un plugin QGIS pour les rassembler tous\"","text":"<p>Le plugin QGIS FluxCEN permet d'acc\u00e9der rapidement \u00e0 un large \u00e9ventail de flux WFS/WMS et de tables PostGIS organis\u00e9s par cat\u00e9gories et interrogeables sous forme de mots-cl\u00e9s.</p> <p>Il \u00e9vite ainsi d'avoir \u00e0 g\u00e9rer dans QGIS une multitude de connexions et simplifie grandement l'acc\u00e8s aux donn\u00e9es dans un syst\u00e8me d'information.</p> <p>Gr\u00e2ce au lien direct avec le d\u00e9p\u00f4t GitHub, l'ajout et la modification des ressources ne n\u00e9cessite pas de publier \u00e0 chaque fois une nouvelle version du plugin.</p> <p></p>"},{"location":"#fonctionnalites","title":"Fonctionnalit\u00e9s","text":"<ul> <li> Centralisation et gestion des ressources dans un fichier .csv au sein de cat\u00e9gories</li> <li> Recherche rapide des ressources par autocompl\u00e9tion</li> <li> Lien direct vers l'URL de la fiche de m\u00e9tadonn\u00e9es pour chaque flux</li> <li> Mise \u00e0 jour du .csv directement depuis le git ind\u00e9pendamment des versions du plugin</li> <li> Prise en charge des flux WFS et WMS (GeoServer et MapServer) avec gestion des styles</li> <li> Acc\u00e8s direct aux tables de l'extension spatiale PostGIS du SGBD PostgreSQL</li> </ul>"},{"location":"#auteurs","title":"Auteurs","text":"<p>FluxCEN est d\u00e9velopp\u00e9 par le service DSI du Conservatoire d'espaces naturels de Nouvelle-Aquitaine</p> <ul> <li>Romain MONTILLET est le d\u00e9veloppeur principal du plugin</li> <li>Thomas GACHET est \u00e0 l'origine du projet et apporte quelques contributions et id\u00e9es </li> </ul>"},{"location":"exemples/","title":"Exemples de mise en production","text":""},{"location":"exemples/#cen-nouvelle-aquitaine-ldap-geoserver-et-ldap2pg","title":"CEN Nouvelle-Aquitaine : LDAP, GeoServer et ldap2pg","text":"<p>Le SIG du CEN Nouvelle-Aquitaine repose en grande partie sur le serveur cartographique GeoServer.</p> <p>Connect\u00e9 aux bases de donn\u00e9es m\u00e9tier, il permet de v\u00e9hiculer en temps r\u00e9el des donn\u00e9es de qualit\u00e9 pour l'ensemble des salari\u00e9s mais aussi pour les partenaires ext\u00e9rieurs.</p> <p>FluxCEN a \u00e9t\u00e9 d\u00e9velopp\u00e9 avec pour objectif de faciliter grandement l'acc\u00e8s aux donn\u00e9es confidentielles.</p> <p>L'id\u00e9e est d'utiliser un identifiant compte CEN NA unique par collaborateur lui permettant de se connecter \u00e0 toutes les applications mais \u00e9galement aux donn\u00e9es prot\u00e9g\u00e9es issues de GeoServer ainsi qu'aux tables PostGIS dans un objectif d'\u00e9dition collaborative.</p> <p></p> <p> Un annuaire LDAP est utilis\u00e9 pour centraliser tous les identifants.</p> <p>GeoServer est ensuite configur\u00e9 pour fonctionner avec les groupes LDAP d\u00e9di\u00e9s (un utilisateur LDAP pouvant \u00eatre dans plusieurs groupes). Lors de la publication d'une couche dans GeoServer, il suffit alors d'indiquer les privil\u00e8ges li\u00e9s au groupe.</p> <p>Exemple</p> <p>Pour acc\u00e9der aux donn\u00e9es prot\u00e9g\u00e9es li\u00e9es \u00e0 l'animation fonci\u00e8re, une espace de travail dans GeoServer est configur\u00e9 pour aller interroger la base de donn\u00e9es de l'application d\u00e9di\u00e9e FoncierCEN.</p> <p>L'acc\u00e8s aux couches de cet espace de travail est alors rendu accessible en lecture uniquement aux membres du groupe LDAP \"Acc\u00e8s G\u00e9oserver avec authentification\".</p> <p></p> <p>Pour utiliser les m\u00eames identifiants pour l'acc\u00e8s aux tables PostGIS, il faut que les r\u00f4les PostgreSQL soit cr\u00e9\u00e9s en lien avec les identifiants LDAP. </p> <p>Comme il est inenvisageable de g\u00e9rer \u00e7a manuellement, l'excellent utilitaire ldap2pg d\u00e9velopp\u00e9 par Dalibo est utilis\u00e9.  Apr\u00e8s configuration, il rend automatique la cr\u00e9ation des r\u00f4les et des privil\u00e8ges li\u00e9s dans PostgreSQL \u00e0 partir de l'annuaire LDAP.</p> <p></p> <p>Il devient alors facile de g\u00e9rer nominatiement les acc\u00e8s aux bases de donn\u00e9es et les privil\u00e8ges associ\u00e9s (lecture, \u00e9criture, supression) avec toujours le m\u00eame identifiant unique.</p> <p>On peut r\u00e9sumer le fonctionnement global gr\u00e2ce au sch\u00e9ma suivant :</p> <pre><code>stateDiagram-v2\n\n  **LDAP** --&gt; **GeoServer**\n  **LDAP** --&gt; PostgreSQL: *ldap2pg*\n  **GeoServer** --&gt; QGIS: *WFS/WMS*\n  PostgreSQL --&gt; QGIS: *PostGIS*\n  state QGIS {\n  QGIS_auth --&gt; FluxCEN\n  }</code></pre>"},{"location":"fonctionnement/","title":"Les fonctionnalit\u00e9s en d\u00e9tail","text":""},{"location":"fonctionnement/#le-fichier-fluxcsv","title":"Le fichier flux.csv","text":"<p>Situ\u00e9 \u00e0 la racine du projet, le fichier <code>flux.csv</code> est le coeur de l'application. C'est lui qui centralise toutes les ressources et permet l'affichage de ces derni\u00e8res dans le plugin.</p> <p>Voici sa description et l'utilisation des champs selon le type de service consult\u00e9 (les champs en gras sont visibles dans le plugin) :</p> Nom du champ Description WMS WFS PostGIS <code>service</code> Type de service utilis\u00e9 (WFS, WMS, PostGIS) <code>categorie</code> Categorie de rattachement de la ressource pour affichage et recherche dans le plugin <code>Nom_couche_plugin</code> Nom de la ressource qui s'affichera dans le plugin <code>nom_technique</code> Nom de la ressource utilis\u00e9 sur le serveur source (nom de la table pour le service PostGIS) <code>url</code> URL du serveur d'acc\u00e8s \u00e0 la ressource <code>source</code> Source de la donn\u00e9e (producteur) <code>style</code> Nom du fichier de style .qml situ\u00e9 dans le dossier styles_couches pour affichage \u00e0 l'ouverture dans QGIS (voir ci-dessous) <code>metadonnees</code> URL de la fiche de m\u00e9tadonn\u00e9es li\u00e9e \u00e0 la resource <code>nom_bdd</code> Nom de la base de donn\u00e9es <code>nom_schema</code> Nom du sch\u00e9ma <p></p>"},{"location":"fonctionnement/#styles-des-ressources-dans-qgis","title":"Styles des ressources dans QGIS","text":""},{"location":"fonctionnement/#parametrer-les-styles","title":"Param\u00e9trer les styles","text":"<p>Les diff\u00e9rentes ressources peuvent \u00eatre charg\u00e9es dans QGIS avec un style par d\u00e9faut selon le service consult\u00e9.</p> <ul> <li>WFS</li> </ul> <p>Le style n'\u00e9tant pas g\u00e9r\u00e9 par le serveur cartographique source, il faut cr\u00e9er un fichier de style d\u00e9di\u00e9 :</p> <ol> <li>Ouvrir le flux dans QGIS</li> <li>Param\u00e9trer le style et l'enregistrer au format <code>.qml</code> (voir la section Attacher des formulaire (UI) en fin de page pour embarquer un formulaire)</li> <li>D\u00e9poser ce fichier .qml nouvellement cr\u00e9\u00e9 dans le dossier <code>styles_couches</code> du git</li> <li>Indiquer le nom du fichier dans la colonne style du fichier flux.csv pour la ressource concern\u00e9e</li> </ol> <ul> <li>WMS</li> </ul> <p>Le style n'est pas g\u00e9r\u00e9 dans FluxCEN mais directement par le serveur cartographique source au format <code>.sld</code>.</p> <ul> <li>PostGIS</li> </ul> <p>Le style par d\u00e9faut peut \u00eatre enregistr\u00e9 directement dans la base de donn\u00e9es source :</p> <ol> <li>Ouvrir la table dans QGIS</li> <li>Param\u00e9trer le style et l'enregistrer dans la base de donn\u00e9es source (Propri\u00e9t\u00e9s de la couche / Style / Enregistrer le style / in datasource database) en cochant la case Utiliser comme style par d\u00e9faut pour cette couche (voir la section Attacher des formulaire (UI) ci-dessous pour embarquer un formulaire)</li> </ol> <p>Bon \u00e0 savoir</p> <p>  Une table layer_styles est cr\u00e9\u00e9e automatiquement dans le sch\u00e9ma public de la base de donn\u00e9es source. Le style est g\u00e9n\u00e9r\u00e9 en qml dans le champ styleqml.</p>"},{"location":"fonctionnement/#attacher-un-formulaire-ui","title":"Attacher un formulaire (UI)","text":"<p>Il peut \u00eatre int\u00e9ressant d'embarquer dans le style un formulaire <code>.ui</code> pour une meilleure consultation et/ou \u00e9dition des donn\u00e9es dans QGIS.</p> <ol> <li>Cr\u00e9er et tester le formulaire via Qt Designer</li> <li>D\u00e9poser le .ui dans le dossier <code>styles_couches</code> du git</li> <li>R\u00e9cup\u00e9rer l'URL publique d'acc\u00e8s depuis le git vers ce fichier nouvellement d\u00e9pos\u00e9 (acc\u00e8s brut via l'option <code>Raw</code>)</li> <li>Coller cette URL dans le champ \u00c9diter interface lors du param\u00e9trage du style dans QGIS (Propri\u00e9t\u00e9s de la couche / Formulaire d'attributs) puis selectionner \u00c0 partir du fichier .ui fourni</li> </ol> <p>L'acc\u00e8s au formulaire .ui est ainsi directement int\u00e9gr\u00e9 au .qml (fichier en dur pour WFS ou champ de base de donn\u00e9es pour PostGIS).</p> <p>Pratique</p> <p>Le formulaire .ui peut \u00eatre d\u00e9sormais mis \u00e0 jour directement depuis le git!</p> <p></p>"},{"location":"fonctionnement/#acces-aux-flux-proteges","title":"Acc\u00e8s aux flux prot\u00e9g\u00e9s","text":"<p>Si l'acc\u00e8s \u00e0 la majorit\u00e9 des ressources reste public, certaines peuvent \u00eatre prot\u00e9g\u00e9es par un couple identifiant/mot de passe (donn\u00e9es m\u00e9tier confidentielles par exemple).</p> <p>L'acc\u00e8s \u00e0 une table PostGIS n\u00e9cessitera toujours quand \u00e0 elle de renseigner un utilisateur et son mot de passe associ\u00e9.</p> <p>Cette authentification n'est pas g\u00e9r\u00e9e depuis FluxCEN mais doit \u00eatre configur\u00e9e depuis les serveurs v\u00e9hiculant les ressources :</p> <ul> <li>depuis le serveur cartographique pour les flux WMS/WFS</li> <li>depuis le serveur de bases de donn\u00e9es pour les tables PostGIS.</li> </ul> <p>Pour acc\u00e9der aux ressources prot\u00e9g\u00e9es, il faut cr\u00e9er en amont une authentification de type <code>Basic authentication</code> dans QGIS (Pr\u00e9f\u00e9rences/Options/Authentification). Cela \u00e9vite de devoir saisir \u00e0 chaque fois son identifiant et son mot de passe \u00e0 l'ouverture d'une ressource prot\u00e9g\u00e9e.</p> <p>Si aucune authentification n'est trouv\u00e9e par QGIS, un message informe de la n\u00e9cessit\u00e9 d'en param\u00e9trer une.</p> <p>Depuis la version 4.7 de FluxCEN, il est possible d'indiquer l'authentification par d\u00e9faut que le plugin devra utiliser pour se connecter \u00e0 partir du bouton  situ\u00e9 en bas \u00e0 droite de la fen\u00eatre. Il devient alors possible de g\u00e9rer plusieurs authentifications si besoin.</p>"},{"location":"utiliser_fluxcen/","title":"Utiliser FluxCEN","text":"<p>FluxCEN \u00e9tant d\u00e9velopp\u00e9 pour \u00eatre utilis\u00e9 au sein du SI d'un organisme, il n'est pas publi\u00e9 dans le d\u00e9p\u00f4t officiel des plugins QGIS. Dans un objectif de d\u00e9ploiement automatique, il doit donc \u00eatre h\u00e9b\u00e9rg\u00e9 dans un d\u00e9p\u00f4t priv\u00e9.</p>"},{"location":"utiliser_fluxcen/#1-forker-le-projet","title":"1. Forker le projet","text":"<p>Forkez le d\u00e9p\u00f4t GitHub de FluxCEN dans votre organisation directement depuis GitHub.</p> <p>Cloner ce nouveau d\u00e9p\u00f4t localement.</p>"},{"location":"utiliser_fluxcen/#2-configurer-le-nouveau-depot","title":"2. Configurer le nouveau d\u00e9p\u00f4t","text":"<p>Le d\u00e9p\u00f4t source \u00e9tant le FluxCEN utilis\u00e9 en production par le CEN Nouvelle-Aquitaint, il convient de proc\u00e9der \u00e0 quelques ajustements avant de commencer.</p>"},{"location":"utiliser_fluxcen/#21-creer-et-editer-les-fichiers-de-configuration","title":"2.1 Cr\u00e9er et \u00e9diter les fichiers de configuration","text":"<p>Deux fichiers de configurations sont n\u00e9cessaires pour le bon fonctionnement du plugin. Ils sont ajout\u00e9s au fichier <code>.gitignore</code> afin de ne pas \u00eatre v\u00e9hicul\u00e9s publiquement sur le git. </p> <p>Il faut donc les cr\u00e9er, en utilisant les deux fichiers exemples situ\u00e9s dans <code>config/yaml</code>.</p> <p></p> <p>Le fichier <code>links.yaml</code> assure le lien entre le plugin dans QGIS et le git, ce qui \u00e9vite de devoir publier une nouvelle version du plugin \u00e0 chaque fois que le fichier flux.csv est modifi\u00e9 par exemple.</p> <p><pre><code>github_urls:\n  flux_csv: \"link_to_the_csv_file (your_flux.csv)\"\n  styles_couches: \"link_to_the_layer_styles_file (your styles_couches folder)\"\n  info_changelog: \"link_to_the_changelog_html (if needed)\"\ndepot_plugins_url:\n  last_version: \"link_to_the_plugin_version (.txt)\"\n</code></pre> Les liens sont \u00e0 copier depuis l'application web GitHub en prenant soin de s\u00e9lectionner l'option <code>Raw</code> afin d'avoir acc\u00e8s au fichier brut.</p> <p></p> <p>Le fichier <code>config_db.yaml</code> est optionnel et doit \u00eatre configur\u00e9 si on veut acc\u00e9der \u00e0 des couches PostGIS. Il accueille ainsi la configuration de l'acc\u00e8s au cluster de base de donn\u00e9es (une seule adresse IP).</p> <pre><code>database:\n  - type: PostGIS\n    host: your_database_ip # Adresse IP du cluster PostgreSQL\n    port: your_database_port (5432 by default) # Port pour acc\u00e9der au cluster PostgreSQL\n</code></pre>"},{"location":"utiliser_fluxcen/#21-modifier-le-fichier-fluxcsv","title":"2.1 Modifier le fichier flux.csv","text":"<p>Afin d'utiliser ses propores flux, il faut maintenant modifier le fichier <code>flux.csv</code>. Le plus simple est de supprimer le fichier existant puis partir du fichier <code>flux_example.csv</code> qui rassemble un certain nombre de ressources nationales (IGN, INPN, etc.) en le renommant.</p> <p>Vous pouvez \u00e9galement supprimer tous les fichiers dans le dossier <code>styles_couches</code> afin de partir d'une base propre.</p>"},{"location":"utiliser_fluxcen/#publier-sur-son-propre-depot-de-plugins-qgis","title":"Publier sur son propre d\u00e9p\u00f4t de plugins QGIS","text":"<p>Une fois la configuration effectu\u00e9e et le fichier flux.csv personnalis\u00e9, vous \u00eates pr\u00eat \u00e0 publier le plugin apr\u00e8s un commit des modifications.</p>"}]}